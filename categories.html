<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>å•†å“åˆ†ç±» - æ¸¡ç‰© Dimension</title>
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    /* é™„åŠ æ ·å¼ï¼šæŠ˜å åˆ—è¡¨ */
    .category-section { margin-bottom: 2rem; }
    .collapsible { 
      background-color: var(--card-bg); 
      border-radius: var(--radius); 
      padding: 1rem; 
      cursor: pointer; 
      margin-bottom: 0.5rem; 
    }
    .collapsible-content { 
      display: none; 
      padding: 0 1rem 1rem; 
    }
    .collapsible-content.active { display: block; }
    .product-list { display: flex; flex-wrap: wrap; gap: 1rem; }
    .product-card {z-index:0; flex: 1 1 30%; text-align: center; }
    .product-card img { max-width: 100%; height: auto; object-fit: cover; }
    .expand-btn { 
      background: var(--primary); 
      border: none; 
      padding: 0.5rem 1rem; 
      border-radius: var(--radius); 
      color: var(--color7); 
      cursor: pointer; 
    }
    .expand-btn:hover { background: var(--color5); }
  </style>
</head>

<div class="logo-sticker">
  <img src="assets/images/logo.png" alt="æ¸¡ç‰© Dimension Logo">
</div>

<div class="top-right-img">
    <img src="assets/images/right_nav.png" alt="top right image">
</div>

<!-- <div class="webbg">
    <img src="assets/images/bg001.png" alt="bg">
</div> -->

<header class="site-header">
  <div class="nav-container">

    <!-- å¯¼èˆªèœå• -->
    <nav class="nav-menu">
	  <div class="nav-item">
          <a href="welcome.html">é¦–é¡µ</a>
        </div>
		
      <div class="nav-item">
        <a href="designs.html">è®¾è®¡</a>
      </div>
	  
      <div class="nav-item dropdown">
        <span><a href="categories.html"  style="color: var(--primary); font-weight: 600;">å•†å“<a></span>
        <div class="dropdown-content">
          <a href="categories.html#åŸºç¡€">åŸºç¡€
		  <img src="assets/images/1.png" alt="åŸºç¡€" class="menu-img">
		  </a>
          <a href="categories.html#ç¯ç±»">ç¯ç±»
		  <img src="assets/images/2.png" alt="ç¯ç±»" class="menu-img">
		  </a>
          <a href="categories.html#åºŠç±»">åºŠç±»
		  <img src="assets/images/3.png" alt="åºŠç±»" class="menu-img">
		  </a>
          <a href="categories.html#æ¡Œç±»">æ¡Œç±»
		  <img src="assets/images/4.png" alt="æ¡Œç±»" class="menu-img">
		  </a>
          <a href="categories.html#æ¤…ç±»">æ¤…ç±»
		  <img src="assets/images/5.png" alt="æ¤…ç±»" class="menu-img">
		  </a>
		  <a href="categories.html#å‡³ç±»">å‡³ç±»
		  <img src="assets/images/6.png" alt="å‡³ç±»" class="menu-img">
		  </a>
		  <a href="categories.html#æ²™å‘">æ²™å‘
		  <img src="assets/images/7.png" alt="æ²™å‘" class="menu-img">
		  </a>
		  <a href="categories.html#æŸœç±»">æŸœç±»
		  <img src="assets/images/8.png" alt="æŸœç±»" class="menu-img">
		  </a>
		  <a href="categories.html#æ¶ç±»">æ¶ç±»
		  <img src="assets/images/9.png" alt="æ¶ç±»" class="menu-img">
		  </a>
		  <a href="categories.html#è£…é¥°">è£…é¥°
		  <img src="assets/images/10.png" alt="è£…é¥°" class="menu-img">
		  </a>
		  <a href="categories.html#ç»„åˆ">ç»„åˆ
		  <img src="assets/images/11.png" alt="ç»„åˆ" class="menu-img">
		  </a>
		  <a href="categories.html#å…¶ä»–">å…¶ä»–
		  <img src="assets/images/12.png" alt="å…¶ä»–" class="menu-img">
		  </a>
        </div>
      </div>

      <div class="nav-item search">
        <input type="text" placeholder="æœç´¢å•†å“..." />
      </div>

      <div class="nav-item">
        <a href="settings.html">è®¾ç½®</a>
      </div>

      <div class="nav-item">
        <a href="user.html">ä¸ªäººä¸­å¿ƒ</a>
      </div>

      <div class="nav-item">
        <a href="contact.html">è”ç³»æˆ‘ä»¬</a>
      </div>
      <div class="nav-item">
          <button class="music-toggle btn btn-outline">ğŸµ</button>
      </div>
    </nav>
  </div>
</header>

<body>
<!-- å¯¼èˆªå ä½ï¼Œç¡®ä¿å†…å®¹ä¸è¢«é¡¶éƒ¨å¯¼èˆªé®æŒ¡ -->
  <div class="nav-spacer"></div>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <main class="container">
    <h1 class="function_title">å•†å“åˆ†ç±»</h1> <!-- é¡µé¢æ ‡é¢˜ -->
    <section id="product-categories"></section> <!-- å•†å“åˆ†ç±»å±•ç¤ºåŒºåŸŸ -->
    <div id="error-message" style="color: red; text-align: center;"></div> <!-- é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
  </main>

  <!-- é¡µè„š -->
  <footer class="site-footer">
    Â© 2025 æ¸¡ç‰© Dimension. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
  </footer>

 <!-- JavaScript ä»£ç  -->
  <script>
    // å®šä¹‰å•†å“åˆ†ç±»åˆ—è¡¨
    const categories = [
      "åŸºç¡€", "ç¯ç±»", "åºŠç±»", "æ¡Œç±»", "æ¤…ç±»", "å‡³ç±»", 
      "æ²™å‘", "æŸœç±»", "æ¶ç±»", "è£…é¥°", "ç»„åˆ", "å…¶ä»–"
    ];

    // åˆ†ç±»ä¸ product_id å‰ç¼€çš„æ˜ å°„
    const categoryMap = {
      "åŸºç¡€": "BS",
      "ç¯ç±»": "LT",
      "åºŠç±»": "BD",
      "æ¡Œç±»": "TB",
      "æ¤…ç±»": "CH",
      "å‡³ç±»": "ST",
      "æ²™å‘": "SF",
      "æŸœç±»": "CB",
      "æ¶ç±»": "SH",
      "è£…é¥°": "DC",
      "ç»„åˆ": "SU",
      "å…¶ä»–": "OT"
    };

    // å ä½æ•°æ®
    const fallbackProducts = [
      { product_id: "BS-001", name: "COMPATTAåœ°æ¿", category: "åŸºç¡€" },
      { product_id: "BS-002", name: "CEMENTORESINAåœ°æ¿", category: "åŸºç¡€" },
      { product_id: "BS-003", name: "ANTICHE PATINEç¡…é…¸ç›æ¶‚æ–™", category: "åŸºç¡€" },
      { product_id: "LT-001", name: "GildaåŠç¯", category: "ç¯ç±»" },
      { product_id: "LT-002", name: "PyriteåŠç¯", category: "ç¯ç±»" },
      { product_id: "LT-003", name: "DAWNåŠç¯", category: "ç¯ç±»" }
    ];

    // è·å–å¹¶æ¸²æŸ“æ•°æ®
    fetch('./assets/data/designs.json')
      .then(response => {
        if (!response.ok) throw new Error(`æ— æ³•åŠ è½½ designs.jsonï¼ŒçŠ¶æ€ç ï¼š${response.status}`);
        return response.json();
      })
      .then(data => {
        console.log('JSON æ•°æ®åŠ è½½æˆåŠŸ:', data);
        renderCategories(data.products);
      })
      .catch(error => {
        document.getElementById('error-message').innerText = `é”™è¯¯ï¼š${error.message}ï¼ˆä½¿ç”¨å ä½æ•°æ®å±•ç¤ºï¼‰`;
        console.error('Fetch Error:', error);
        renderCategories(fallbackProducts);
      });

    // æ¸²æŸ“åˆ†ç±»çš„å‡½æ•°
    function renderCategories(products) {
      const productCategories = document.getElementById('product-categories');
      productCategories.innerHTML = categories
        .filter(category => products.some(p => p.product_id.startsWith(categoryMap[category])))
        .map(category => {
          const categoryProducts = products.filter(p => p.product_id.startsWith(categoryMap[category]));
          const initialProducts = categoryProducts.slice(0, 3);
          return `
            <div id="${category}" class="category-section">
              <div class="collapsible">
                <h2>${category} (${initialProducts.length}/${
                  categoryProducts.length
                })</h2>
                <button class="expand-btn" onclick="toggleExpand('${category}')">
                  å±•å¼€
                </button>
              </div>
              <div class="collapsible-content" id="content-${category}">
                <div class="product-list flex gap-2">
                  ${initialProducts.map(product => `
                    <div class="product-card form-card">
                      <img src="./assets/images/${product.product_id.split('-')[0].toLowerCase()}/${product.product_id}.jpg" 
                           alt="${product.name}" 
                           class="index_sample-img" 
                           onerror="this.src='./assets/images/placeholder.jpg'">
                      <p>${product.name}</p>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          `;
        }).join('');

      // æ·»åŠ å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
      window.addEventListener('hashchange', () => {
        const category = window.location.hash.slice(1);
        if (category && document.getElementById(category)) {
          document.getElementById(category).scrollIntoView({ behavior: 'smooth' });
        }
      });
      if (window.location.hash) {
        const category = window.location.hash.slice(1);
        document.getElementById(category)?.scrollIntoView({ behavior: 'smooth' });
      }
    }

    // åˆ‡æ¢å±•å¼€/æ”¶èµ·å‡½æ•°
    function toggleExpand(category) {
      const content = document.getElementById(`content-${category}`);
      const allProducts = Array.from(document.querySelectorAll(`#content-${category} .product-card`)).length === 3;
      const button = content.previousElementSibling.querySelector('.expand-btn');

      if (allProducts) {
        // å±•å¼€æ‰€æœ‰å•†å“
        const categoryProducts = JSON.parse(localStorage.getItem(`products-${category}`)) || [];
        if (categoryProducts.length === 0) {
          fetch('./assets/data/designs.json')
            .then(response => response.json())
            .then(data => {
              const all = data.products.filter(p => p.product_id.startsWith(categoryMap[category]));
              localStorage.setItem(`products-${category}`, JSON.stringify(all));
              renderExpanded(category, all);
            });
        } else {
          renderExpanded(category, categoryProducts);
        }
        button.textContent = 'æ”¶èµ·';
      } else {
        // æ”¶èµ·ï¼Œä»…æ˜¾ç¤ºå‰ä¸‰ä¸ª
        content.innerHTML = `
          <div class="product-list flex gap-2">
            ${Array.from(content.querySelectorAll('.product-card')).slice(0, 3).map(card => card.outerHTML).join('')}
          </div>
        `;
        button.textContent = 'å±•å¼€';
      }
    }

    // æ¸²æŸ“å±•å¼€çš„å†…å®¹
    function renderExpanded(category, products) {
      const content = document.getElementById(`content-${category}`);
      content.innerHTML = `
        <div class="product-list flex gap-2">
          ${products.map(product => `
            <div class="product-card form-card">
              <img src="./assets/images/${product.product_id.split('-')[0].toLowerCase()}/${product.product_id}.jpg" 
                   alt="${product.name}" 
                   class="index_sample-img" 
                   onerror="this.src='./assets/images/placeholder.jpg'">
              <p>${product.name}</p>
            </div>
          `).join('')}
        </div>
      `;
      content.classList.add('active');
    }
  </script>
      <script src="assets/js/search.js"></script>
    <script src="assets/js/music.js"></script>
</body>
</html>