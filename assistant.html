<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIåŠ©æ‰‹ - æ¸¡ç‰© Dimension</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .chat-container {
      max-height: 60vh;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--gap);
      margin-bottom: var(--gap);
      background: var(--color7);
    }
    .message {
      margin-bottom: var(--gap);
      padding: 0.5rem;
      border-radius: 0.5rem;
      max-width: 80%;
    }
    .message.user {
      background: var(--primary);
      color: #fff;
      margin-left: auto;
    }
    .message.ai {
      background: var(--card-bg);
      color: var(--text);
    }
    .message img {
      max-width: 100px;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .message-content span.bold-text {
      font-weight: 600;
      color: var(--primary);
    }
    #loading {
      text-align: center;
      color: var(--muted);
    }
    .dark-mode .message.user {
      background: var(--color5);
    }
    .dark-mode .message.ai {
      background: var(--color4);
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav-container">
      <nav class="nav-menu">
        <div class="nav-item"><a href="index.html">é¦–é¡µ</a></div>
        <div class="nav-item"><a href="designs.html">è®¾è®¡</a></div>
        <div class="nav-item dropdown">
          <a href="categories.html">å•†å“</a>
          <div class="dropdown-content">
            <a href="categories.html#basic">åŸºç¡€</a>
            <a href="categories.html#light">ç¯ç±»</a>
            <a href="categories.html#bed">åºŠç±»</a>
            <a href="categories.html#table">æ¡Œç±»</a>
            <a href="categories.html#chair">æ¤…ç±»</a>
            <a href="categories.html#stool">å‡³ç±»</a>
            <a href="categories.html#sofa">æ²™å‘</a>
            <a href="categories.html#cabinet">æŸœç±»</a>
            <a href="categories.html#shelf">æ¶ç±»</a>
            <a href="categories.html#decoration">è£…é¥°</a>
            <a href="categories.html#suite">ç»„åˆ</a>
            <a href="categories.html#other">å…¶ä»–</a>
          </div>
        </div>
        <div class="nav-item search"><input type="text" placeholder="æœç´¢..."></div>
        <div class="nav-item"><a href="settings.html">è®¾ç½®</a></div>
        <div class="nav-item"><a href="profile.html">ä¸ªäººä¸­å¿ƒ</a></div>
        <div class="nav-item"><a href="contact.html">è”ç³»æˆ‘ä»¬</a></div>
        <div class="nav-item">ğŸµ</div>
      </nav>
    </div>
  </header>
  <div class="nav-spacer"></div>
  <div class="container">
    <h1 class="function_title">AIåŠ©æ‰‹</h1>
    <div class="form-card">
      <div class="chat-container" id="messages"></div>
      <div class="flex flex-col gap-1">
        <label>
          <span>è¾“å…¥æ¶ˆæ¯</span>
          <input type="text" id="chat-input" placeholder="è¾“å…¥æ‚¨çš„æ¶ˆæ¯...">
        </label>
        <button type="submit" class="btn" onclick="sendMessage()">å‘é€</button>
      </div>
    </div>
  </div>
  <footer class="site-footer">
    <p>Â© 2025 æ¸¡ç‰© Dimension. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
  </footer>
  <script>
    // æ ¼å¼åŒ–æ¶ˆæ¯æ–‡æœ¬
    function formatMessage(text) {
      if (!text) return '';
      let lines = text.split('\n');
      let formattedLines = lines.map(line => {
        line = line.replace(/\*\*(.*?)\*\*/g, '<span class="bold-text">$1</span>');
        return line;
      });
      let processedText = formattedLines.join('\n');
      let sections = processedText
        .split('###')
        .filter(section => section.trim())
        .map(section => {
          let lines = section.split('\n').filter(line => line.trim());
          if (lines.length === 0) return '';
          let result = '';
          let currentIndex = 0;
          while (currentIndex < lines.length) {
            let line = lines[currentIndex].trim();
            if (/^\d+\./.test(line)) {
              result += `<p class="section-title">${line}</p>`;
            } else if (line.startsWith('-')) {
              result += `<p class="subsection"><span class="bold-text">${line.replace(/^-/, '').trim()}</span></p>`;
            } else if (line.includes(':')) {
              let [subtitle, content] = line.split(':').map(part => part.trim());
              result += `<p><span class="subtitle">${subtitle}</span>: ${content}</p>`;
            } else {
              result += `<p>${line}</p>`;
            }
            currentIndex++;
          }
          return result;
        });
      return sections.join('');
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function displayMessage(role, message) {
      const messagesContainer = document.getElementById('messages');
      const messageElement = document.createElement('div');
      messageElement.className = `message ${role}`;
      const avatar = document.createElement('img');
      avatar.src = role === 'user' ? 'assets/images/user-avatar.png' : 'assets/images/bot-avatar.png';
      avatar.alt = role === 'user' ? 'User' : 'Bot';
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      messageContent.innerHTML = role === 'user' ? message : formatMessage(message);
      messageElement.appendChild(avatar);
      messageElement.appendChild(messageContent);
      messagesContainer.appendChild(messageElement);
      messageElement.scrollIntoView({ behavior: 'smooth' });
    }

    // å‘é€æ¶ˆæ¯
    function sendMessage() {
      const inputElement = document.getElementById('chat-input');
      const message = inputElement.value;
      if (!message.trim()) return;
      displayMessage('user', message);
      inputElement.value = '';
      const loadingElement = document.createElement('div');
      loadingElement.id = 'loading';
      loadingElement.style.display = 'block';
      loadingElement.textContent = 'åŠ è½½ä¸­...';
      document.getElementById('messages').appendChild(loadingElement);
      const apiKey = 'sk-5667c8b26be74ec5904616e7638ffc1e'; // æ›¿æ¢ä¸ºå®é™…APIå¯†é’¥
      const endpoint = 'https://api.deepseek.com/chat/completions';
      const payload = {
        model: "deepseek-chat",
        messages: [
          { role: "system", content: "ä½ æ˜¯æ¸¡ç‰©Dimensionçš„AIåŠ©æ‰‹ï¼Œä¸“æ³¨äºæä¾›å®¶å±…è®¾è®¡å»ºè®®ï¼Œé£æ ¼ç®€æ´ã€ç°ä»£ï¼Œå›ç­”ä¸“ä¸šä¸”å…·è±¡åŒ–ï¼Œå¸®åŠ©ç”¨æˆ·ä¼˜åŒ–å®¤å†…å¸ƒå±€ä¸è£…é¥°é€‰æ‹©ã€‚" },
          { role: "user", content: message }
        ],
        stream: false
      };
      fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (loadingElement) loadingElement.remove();
        if (data.choices && data.choices.length > 0) {
          displayMessage('bot', data.choices[0].message.content);
        } else {
          displayMessage('bot', 'å‡ºé”™äº†ï¼Œè¯·ç¨åå†è¯•ã€‚');
        }
      })
      .catch(error => {
        if (loadingElement) loadingElement.remove();
        displayMessage('bot', 'å‡ºé”™äº†ï¼Œè¯·ç¨åå†è¯•ã€‚');
        console.error('Error:', error);
      });
    }

    // æ·»åŠ å›è½¦å‘é€åŠŸèƒ½
    document.getElementById('chat-input').addEventListener('keypress', function(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    });

    // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const chatContainer = document.querySelector('.chat-container');
      chatContainer.classList.toggle('dark-mode');
      const messages = document.querySelector('#messages');
      messages.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¸»é¢˜è®¾ç½®
    document.addEventListener('DOMContentLoaded', () => {
      const isDarkMode = localStorage.getItem('darkMode') === 'true';
      if (isDarkMode) {
        document.body.classList.add('dark-mode');
        document.querySelector('.chat-container').classList.add('dark-mode');
        document.querySelector('#messages').classList.add('dark-mode');
      }
    });
  </script>
</body>
</html>