<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>商品分类 - 渡物 Dimension</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<div class="logo-sticker">
  <img src="assets/images/logo.png" alt="渡物 Dimension Logo">
</div>

<header class="site-header">
  <div class="nav-container">

    <!-- 导航菜单 -->
    <nav class="nav-menu">
	  <div class="nav-item">
          <a href="welcome.html">首页</a>
        </div>
		
      <div class="nav-item">
        <a href="designs.html">设计</a>
      </div>
	  
      <div class="nav-item dropdown">
        <span><a href="categories.html"  style="color: var(--primary); font-weight: 600;">商品<a></span>
        <div class="dropdown-content">
          <a href="#">基础
		  <img src="assets/images/1.png" alt="基础" class="menu-img">
		  </a>
          <a href="#">灯类
		  <img src="assets/images/2.png" alt="灯类" class="menu-img">
		  </a>
          <a href="#">床类
		  <img src="assets/images/3.png" alt="床类" class="menu-img">
		  </a>
          <a href="#">桌类
		  <img src="assets/images/4.png" alt="桌类" class="menu-img">
		  </a>
          <a href="#">椅类
		  <img src="assets/images/5.png" alt="椅类" class="menu-img">
		  </a>
		  <a href="#">凳类
		  <img src="assets/images/6.png" alt="凳类" class="menu-img">
		  </a>
		  <a href="#">沙发
		  <img src="assets/images/7.png" alt="沙发" class="menu-img">
		  </a>
		  <a href="#">柜类
		  <img src="assets/images/8.png" alt="柜类" class="menu-img">
		  </a>
		  <a href="#">架类
		  <img src="assets/images/9.png" alt="架类" class="menu-img">
		  </a>
		  <a href="#">装饰
		  <img src="assets/images/10.png" alt="装饰" class="menu-img">
		  </a>
		  <a href="#">组合
		  <img src="assets/images/11.png" alt="组合" class="menu-img">
		  </a>
		  <a href="#">其他
		  <img src="assets/images/12.png" alt="其他" class="menu-img">
		  </a>
        </div>
      </div>

      <div class="nav-item search">
        <input type="text" placeholder="搜索商品..." />
      </div>

      <div class="nav-item">
        <a href="settings.html">设置</a>
      </div>

      <div class="nav-item">
        <a href="user.html">个人中心</a>
      </div>

      <div class="nav-item">
        <a href="contact.html">联系我们</a>
      </div>
    </nav>
  </div>
</header>

<body>
  
  <div class="nav-spacer"></div>

  <!-- 分类和商品展示区 -->
  <main class="container flex" style="gap:2rem;">
    <!-- 分类导航 -->
    <aside id="category-list" style="min-width:160px;">
      <!-- JS填充分类 -->
    </aside>
    <!-- 商品列表 -->
    <section id="product-list" class="flex-col gap-2" style="flex:1;">
      <!-- JS填充商品卡片 -->
    </section>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 渡物 Dimension. 保留所有权利。</p>
  </footer>

  <!-- 商品分类页面逻辑 -->
  <script>
    // 分类映射（与下拉菜单顺序一致）
    const CATEGORY_MAP = [
      { key: "基础", prefix: ["BS-", "SU-"] },
      { key: "灯类", prefix: ["LT-"] },
      { key: "床类", prefix: ["BD-"] },
      { key: "桌类", prefix: ["TB-"] },
      { key: "椅类", prefix: ["CH-"] },
      { key: "凳类", prefix: ["ST-"] },
      { key: "沙发", prefix: ["SF-"] },
      { key: "柜类", prefix: ["CB-"] },
      { key: "架类", prefix: ["SH-"] },
      { key: "装饰", prefix: ["DC-"] },
      { key: "组合", prefix: ["SU-"] },
      { key: "其他", prefix: ["OT-"] }
    ];

    // 商品数据缓存
    let products = [];
    let currentCategory = CATEGORY_MAP[0].key;

    // 获取商品数据
    async function fetchProducts() {
      try {
        const res = await fetch('assets/data/designs.json');
        const data = await res.json();
        products = data.products || [];
        renderCategories();
        renderProducts(currentCategory);
      } catch (e) {
        document.getElementById('product-list').innerHTML = '<div>商品数据加载失败</div>';
      }
    }

    // 渲染分类导航
    function renderCategories() {
      const catList = document.getElementById('category-list');
      catList.innerHTML = '<h3 style="margin-bottom:1rem;">分类</h3>' +
        CATEGORY_MAP.map(cat =>
          `<div class="category-item" style="margin-bottom:0.5rem;cursor:pointer;font-weight:${cat.key===currentCategory?'bold':'normal'};color:${cat.key===currentCategory?'var(--primary)':'inherit'}"
            onclick="selectCategory('${cat.key}')">${cat.key}</div>`
        ).join('');
    }

    // 切换分类
    window.selectCategory = function(key) {
      currentCategory = key;
      renderCategories();
      renderProducts(key);
    }

    // 获取分类缩写
    function getCategoryPrefix(productId) {
      return productId.split('-')[0].toLowerCase();
    }

    // 获取商品图片路径
    function getProductImage(productId) {
      const prefix = getCategoryPrefix(productId);
      return `assets/images/${prefix}/${productId}.png`;
    }

    // 获取分类图标编号
    function getCategoryIcon(productId) {
      for (let i = 0; i < CATEGORY_MAP.length; i++) {
        if (CATEGORY_MAP[i].prefix.some(pre => productId.startsWith(pre))) {
          return i + 1;
        }
      }
      return 12; // 其他
    }

    // 渲染商品列表
    function renderProducts(categoryKey, searchText='') {
      const cat = CATEGORY_MAP.find(c => c.key === categoryKey);
      let filtered = products.filter(p =>
        cat.prefix.some(pre => p.product_id.startsWith(pre))
      );
      if (searchText) {
        filtered = filtered.filter(p =>
          p.name.includes(searchText) || (p.description && p.description.includes(searchText))
        );
      }
      const list = document.getElementById('product-list');
      if (filtered.length === 0) {
        list.innerHTML = '<div>暂无商品</div>';
        return;
      }
      list.innerHTML = filtered.map(p => `
        <div class="form-card" style="display:flex;flex-direction:row;align-items:center;gap:1rem;">
          <div style="width:60px;height:60px;background:#eee;border-radius:8px;display:flex;align-items:center;justify-content:center;">
            <img src="${getProductImage(p.product_id)}"
                 alt="${p.name}"
                 style="width:48px;height:48px;object-fit:contain;"
                 onerror="this.onerror=null;this.src='assets/images/${getCategoryIcon(p.product_id)}.png';">
          </div>
          <div style="flex:1;">
            <div style="font-weight:600;font-size:1.1rem;">${p.name}</div>
            <div style="color:var(--muted);font-size:0.95rem;">${p.designer} | ${p.price}</div>
            <div style="font-size:0.9rem;color:#666;">${p.description}</div>
          </div>
        </div>
      `).join('');
    }

    // 搜索功能
    document.querySelector('.nav-item.search input').addEventListener('input', function(e){
      renderProducts(currentCategory, e.target.value.trim());
    });

    // 页面加载
    fetchProducts();
  </script>
</body>

</html>